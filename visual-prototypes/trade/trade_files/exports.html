<!DOCTYPE html>
<!-- saved from url=(0117)https://www.ons.gov.uk/visualisations/dvc390/treemap/exports.html?initialWidth=700&childId=7de-4d25-aeb7-811d96408e0e -->
<html lang="en" class=" js flexbox canvas canvastext webgl no-touch geolocation postmessage websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients cssreflections csstransforms csstransforms3d csstransitions fontface generatedcontent video audio localstorage sessionstorage webworkers applicationcache svg inlinesvg smil svgclippaths"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Trade - Exports treemap</title>
<meta name="description" content="">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="./styles.css" media="screen">
<style>
body{
	max-width:700px;
}

#svgEle{
	width:100%;
}

text {
  pointer-events: none;
}

.grandparent text {
  /*font-weight: bold;*/
  fill: #606060;
  font-size:1.8em;
}

rect {
  fill: none;
  stroke: #fff;
}

.grandparent{
/*	pointer-events:none;*/
}


rect.parent,
.grandparent rect {
  stroke-width: 2px;
}

.grandparent line {
  stroke: #606060;
  stroke-width: 1px;
}

.btn{
	font-size:13px
}

.children rect.parent,
.grandparent rect {
  cursor: pointer;
}

.children rect.parent {
  fill: #bbb;
  fill-opacity: .2;
}

.children:hover rect.child {
  fill: #bbb;
}

*[code*=c1_] {
	fill:teal;
}

*[code*=c2_] {
	fill:#006080;
}

*[code*=c3_] {
	fill:#9C566B;
}

*[code*=c4_] {
	fill:#0073b3;
}

*[code*=c5_] {
	fill:#007c58;
}
*[code*=c6_] {
	fill:#ce5b67;
}

*[code*=c7_] {
	fill:#d32b3c;
}

*[code*=c8_] {
	fill:#75bc9a;
}

*[code*=c9_] {
	fill:#44a2cc;
}

*[code*=c10_] {
	fill:#f4b97d;
}

*[code*=c11_] {
	fill:#f6aa53;
}

*[code*=c12_] {
	fill:#007c58;
}
*[code*=c13_] {
	fill:#ed7d04;
}

.depth text{
	fill:white;
}

#blurb{
	pointer-events:none;
	line-height: 2.2em;
	font-size:1em;
	font-weight: 600;
}


#txt2{
	font-weight:200;	
}

@media (max-width: 500px) {

}


@media (min-width: 501px) {

}

	

@media (min-width: 939px) {
  		
}


@media (min-width: 1200px) {
  	
}

.horizLine{
	border-bottom:1px solid #B9B9B9;	
	padding-bottom:5px;
	margin:0px 0px 5px -5px;
}





.btn-ons {
  color: #6f6f6f;
  background-color: #ffffff;
  border-color: #D3D3D3;
}
.btn-ons:hover,
.btn-ons:focus,
.btn-ons.focus,
.btn-ons:active,
.btn-ons.active,
.open > .dropdown-toggle.btn-ons {
  color: #6f6f6f;
  background-color: #E7E7E7;
  border-color: #D3D3D3;
}

hr {
  margin-top: 0px;
  margin-bottom: 3px;
  border: 0;
  border-top: 1px solid #dddddd;
}

#intro{
	display:none;
}

#social{
	top:5px;
}

.social {
			padding-top:5px;
			padding-left:5px;
			float:right;
			opacity:0.5;
			cursor:pointer;
		}
		
		.social:hover {
			opacity:1;
				
		}
		
		
		.social {
			
		}
		
		#embedrow {
			padding-bottom:5px;
			margin:5px;
			border-bottom:1px solid #d3d3d3;
			border-top:1px solid #d3d3d3;
		}
		
		
		#close {
			padding-bottom:3px;	
		}
		
		#allDivs{
			margin:auto;	
		}

#ieMsg{
	width: 940px;
    margin: 0 auto;
}
#suptext {
	padding:20px 20px 20px 20px;
	width:900px;
	background-color:#F2EEF5;
}

#suptext p{
	margin:0px 20px 10px 20px;
	font-family: Helvetica, Arial, sans-serif;
    font-size:14px;
	color:#8064A0;

}

#suptext a{
	font-family: Helvetica, Arial, sans-serif;
    font-size:14px;
	color:#8064A0;

}

#suptext h1{
	margin:0px;
	font-family: Helvetica, Arial, sans-serif;
    font-size:24px;
	color:#8064A0;
}

#thumbNail{
	top:0px;
	left:0px;
}

.img-responsive,
.thumbnail > img,
.thumbnail a > img,
.carousel-inner > .item > img,
.carousel-inner > .item > a > img {
  width: 100% !important;
  

}

#source{
	font-size:12px;	
}

.item{
	width:80px;
	height:80px;
}

</style>
</head>
<body id="childt" marginheight="0">
<div class="container-fluid">
<div id="main-wrapper">
<div id="mainContent" style="">
<div id="blurb" class="row">
<text id="txt2">
<text id="txt3">Total exports: £517,446 million</text></text></div>
<div class="row">
<button type="button" id="upBtn" class="nav btn btn-ons ">
<span class="glyphicon glyphicon-upload" aria-hidden="true"></span> Up a level
</button>
<button type="button" id="topBtn" class="nav btn btn-ons ">
<span class="glyphicon glyphicon-upload" aria-hidden="true"></span> Back to top
</button>
</div>
<div class="row">
<div id="chart"><svg id="svgEle" width="670px" height="550px" preserveAspectRatio="xMidYMid meet" style="margin-left: 0px;"><g id="tree" transform="translate(0,0)"><g class="depth"><g class="children"><rect class="child" code="c2_1" desc="Iceland" id="c2_1" vals="402" realvals="402" x="665.5462280396748" y="484.32451619935773" width="4.453771960325184" height="65.67548380064238"></rect><rect class="child" code="c2_2" desc="Norway" id="c2_2" vals="6035" realvals="6035" x="598.6842534611617" y="484.32451619935773" width="66.86197457851313" height="65.67548380064238"></rect><rect class="child" code="c2_3" desc="Switzerland" id="c2_3" vals="20964" realvals="20964" x="598.6842534611617" y="270.43282093810774" width="71.31574653883831" height="213.89169526125"></rect><rect class="parent" desc="European Free Trade Association" id="c2" vals="27401" realvals="27460" x="598.6842534611617" y="270.43282093810774" width="71.31574653883831" height="279.56717906189226"></rect><text class="parentLabels" dy="1em" y="276.43282093810774" x="604.6842534611617" style="font-size: 11.1198px;"><tspan dy="1em">European </tspan><tspan x="604.6842534611617" dy="1em">Free  Trade </tspan><tspan x="604.6842534611617" dy="1em">Association </tspan><tspan x="604.6842534611617" dy="1em">£27,460m </tspan></text></g><g class="children"><rect class="child" code="c1_8" desc="Estonia" id="c1_8" vals="253" realvals="253" x="584.2160437140715" y="537.2763729892597" width="14.468209747090327" height="12.723627010740302"></rect><rect class="child" code="c1_25" desc="Slovenia" id="c1_25" vals="334" realvals="334" x="565.115719383922" y="537.2763729892597" width="19.10032433014942" height="12.723627010740302"></rect><rect class="child" code="c1_16" desc="Latvia" id="c1_16" vals="348" realvals="348" x="565.115719383922" y="529.7332346592129" width="33.56853407723963" height="7.543138330046872"></rect><rect class="child" code="c1_4" desc="Croatia" id="c1_4" vals="362" realvals="362" x="552.1191318588307" y="529.7332346592129" width="12.9965875250914" height="20.266765340787174"></rect><rect class="child" code="c1_17" desc="Lithuania" id="c1_17" vals="464" realvals="464" x="552.1191318588307" y="522.4828267038351" width="46.565121602331146" height="7.250407955377909"></rect><rect class="child" code="c1_24" desc="Slovakia" id="c1_24" vals="714" realvals="714" x="533.2392358769657" y="522.4828267038351" width="18.879895981864934" height="27.51717329616497"></rect><rect class="child" code="c1_3" desc="Bulgaria" id="c1_3" vals="761" realvals="761" x="513.1165456217848" y="522.4828267038351" width="20.12269025518094" height="27.51717329616497"></rect><rect class="child" code="c1_19" desc="Malta" id="c1_19" vals="926" realvals="926" x="557.2646520710608" y="506.21572147652876" width="41.419601390100866" height="16.267105227306388"></rect><rect class="child" code="c1_5" desc="Cyprus" id="c1_5" vals="987" realvals="987" x="513.1165456217848" y="506.21572147652876" width="44.14810644927604" height="16.267105227306388"></rect><rect class="child" code="c1_23" desc="Romania" id="c1_23" vals="1578" realvals="1578" x="513.1165456217848" y="492.79727294088343" width="85.56770783937691" height="13.418448535645268"></rect><rect class="child" code="c1_13" desc="Hungary" id="c1_13" vals="1808" realvals="1808" x="462.0074256428023" y="524.2601964850965" width="51.109119978982505" height="25.739803514903656"></rect><rect class="child" code="c1_12" desc="Greece" id="c1_12" vals="2210" realvals="2210" x="462.0074256428023" y="492.79727294088343" width="51.109119978982505" height="31.462923544212913"></rect><rect class="child" code="c1_18" desc="Luxembourg" id="c1_18" vals="2391" realvals="2391" x="531.401096097831" y="466.9402561585541" width="67.2831573633307" height="25.857016782329367"></rect><rect class="child" code="c1_22" desc="Portugal" id="c1_22" vals="2466" realvals="2466" x="462.0074256428023" y="466.9402561585541" width="69.39367045502871" height="25.857016782329367"></rect><rect class="child" code="c1_1" desc="Austria" id="c1_1" vals="2615" realvals="2615" x="415.4381385845791" y="509.1419807852933" width="46.56928705822315" height="40.8580192147067"></rect><rect class="child" code="c1_9" desc="Finland" id="c1_9" vals="2701" realvals="2701" x="415.4381385845791" y="466.9402561585541" width="46.56928705822315" height="42.20172462673918"></rect><rect class="child" code="c1_6" desc="Czech Republic" id="c1_6" vals="2786" realvals="2786" x="536.1507311625141" y="434.5232110910733" width="62.53352229864754" height="32.41704506748084"></rect><rect class="child" code="c1_21" desc="Poland" id="c1_21" vals="5378" realvals="5378" x="415.4381385845791" y="434.5232110910733" width="120.71259257793503" height="32.41704506748084"></rect><rect class="child" code="c1_7" desc="Denmark" id="c1_7" vals="5579" realvals="5579" x="324.60900902175894" y="505.3073183959138" width="90.82912956282019" height="44.692681604086204"></rect><rect class="child" code="c1_27" desc="Sweden" id="c1_27" vals="8836" realvals="8836" x="324.60900902175894" y="434.5232110910733" width="90.82912956282019" height="70.78410730484052"></rect><rect class="child" code="c1_26" desc="Spain" id="c1_26" vals="14766" realvals="14766" x="231.5682232344122" y="434.5232110910733" width="93.04078578734669" height="115.47678890892672"></rect><rect class="child" code="c1_2" desc="Belgium" id="c1_2" vals="15176" realvals="15176" x="429.1257631476566" y="369.39892415134284" width="169.5584903135051" height="65.12428693973044"></rect><rect class="child" code="c1_15" desc="Italy" id="c1_15" vals="17682" realvals="17682" x="231.5682232344122" y="369.39892415134284" width="197.5575399132444" height="65.12428693973044"></rect><rect class="child" code="c1_14" desc="Ireland" id="c1_14" vals="25679" realvals="25679" x="128.1104852794655" y="369.39892415134284" width="103.45773795494668" height="180.60107584865716"></rect><rect class="child" code="c1_20" desc="Netherlands" id="c1_20" vals="31798" realvals="31798" x="0" y="369.39892415134284" width="128.1104852794655" height="180.60107584865716"></rect><rect class="child" code="c1_10" desc="France" id="c1_10" vals="32928" realvals="32928" x="356.5902194196147" y="270.43282093810774" width="242.094034041547" height="98.9661032132351"></rect><rect class="child" code="c1_11" desc="Germany" id="c1_11" vals="48501" realvals="48501" x="0" y="270.43282093810774" width="356.5902194196147" height="98.9661032132351"></rect><rect class="parent" desc="EU" id="c1" vals="230027" realvals="230031" x="0" y="270.43282093810774" width="598.6842534611617" height="279.56717906189226"></rect><text class="parentLabels" dy="1em" y="276.43282093810774" x="6" style="font-size: 39.9057px;"><tspan dy="1em">EU  £230,031m </tspan></text></g><g class="children"><rect class="child" code="c3_2" desc="Albania" id="c3_2" vals="24" realvals="24" x="665.2399526556576" y="266.76418028922666" width="4.760047344342411" height="3.6686406488810235"></rect><rect class="child" code="c3_3" desc="Belarus" id="c3_3" vals="72" realvals="72" x="650.9598106226448" y="266.76418028922666" width="14.280142033012794" height="3.6686406488810235"></rect><rect class="child" code="c3_22" desc="Iran" id="c3_22" vals="189" realvals="189" x="650.9598106226448" y="259.541544011744" width="19.040189377355205" height="7.222636277482707"></rect><rect class="child" code="c3_14" desc="Uruguay" id="c3_14" vals="246" realvals="246" x="634.5251208442975" y="259.541544011744" width="16.43468977834732" height="10.89127692636373"></rect><rect class="child" code="c3_15" desc="Venezuela" id="c3_15" vals="337" realvals="337" x="634.5251208442975" y="252.62937767618013" width="35.474879155702524" height="6.912166335563882"></rect><rect class="child" code="c3_6" desc="Ukraine" id="c3_6" vals="416" realvals="416" x="634.5251208442975" y="244.0968518732289" width="35.474879155702524" height="8.532525802951227"></rect><rect class="child" code="c3_27" desc="Philippines" id="c3_27" vals="546" realvals="546" x="603.3326453249927" y="257.6963824000884" width="31.19247551930482" height="12.736438538019343"></rect><rect class="child" code="c3_7" desc="Argentina" id="c3_7" vals="583" realvals="583" x="603.3326453249927" y="244.0968518732289" width="31.19247551930482" height="13.599530526859496"></rect><rect class="child" code="c3_11" desc="Colombia" id="c3_11" vals="629" realvals="629" x="585.954375084388" y="244.0968518732289" width="17.378270240604706" height="26.33596906487884"></rect><rect class="child" code="c3_10" desc="Chile" id="c3_10" vals="719" realvals="719" x="632.3026797789613" y="230.21895627460944" width="37.697320221038694" height="13.87789559861946"></rect><rect class="child" code="c3_40" desc="Morocco" id="c3_40" vals="884" realvals="884" x="585.954375084388" y="230.21895627460944" width="46.34830469457336" height="13.87789559861946"></rect><rect class="child" code="c3_21" desc="Indonesia" id="c3_21" vals="892" realvals="892" x="553.2227205155308" y="250.6037621875049" width="32.73165456885715" height="19.829058750602826"></rect><rect class="child" code="c3_42" desc="Algeria, Tunisia and Libya" id="c3_42" vals="917" realvals="917" x="553.2227205155308" y="230.21895627460944" width="32.73165456885715" height="20.384805912895473"></rect><rect class="child" code="c3_26" desc="Pakistan" id="c3_26" vals="917" realvals="917" x="612.827140796979" y="218.54858619175664" width="57.17285920302095" height="11.670370082852799"></rect><rect class="child" code="c3_17" desc="Bolivia, Peru, Ecuador, Paraguay, Suriname, Guyana" id="c3_17" vals="956" realvals="956" x="553.2227205155308" y="218.54858619175664" width="59.604420281448256" height="11.670370082852799"></rect><rect class="child" code="c3_37" desc="New Zealand" id="c3_37" vals="1032" realvals="1032" x="521.0097493403387" y="247.1221852140179" width="32.21297117519214" height="23.31063572408985"></rect><rect class="child" code="c3_38" desc="Other Australasia and Oceania" id="c3_38" vals="1265" realvals="1265" x="521.0097493403387" y="218.54858619175664" width="32.21297117519214" height="28.57359902226125"></rect><rect class="child" code="c3_39" desc="Egypt" id="c3_39" vals="1687" realvals="1687" x="598.268677835945" y="201.43616539439088" width="71.73132216405497" height="17.112420797365758"></rect><rect class="child" code="c3_31" desc="Taiwan" id="c3_31" vals="1817" realvals="1817" x="521.0097493403387" y="201.43616539439088" width="77.25892849560637" height="17.112420797365758"></rect><rect class="child" code="c3_32" desc="Thailand" id="c3_32" vals="1912" realvals="1912" x="480.25045440831775" y="236.30045214131945" width="40.759294932020794" height="34.132368796788285"></rect><rect class="child" code="c3_12" desc="Mexico" id="c3_12" vals="1953" realvals="1953" x="480.25045440831775" y="201.43616539439088" width="40.759294932020794" height="34.8642867469286"></rect><rect class="child" code="c3_23" desc="Israel" id="c3_23" vals="2015" realvals="2015" x="577.8907891189497" y="185.51857982433765" width="92.10921088105033" height="15.917585570053262"></rect><rect class="child" code="c3_34" desc="Other Near &amp; Middle Eastern Countries" id="c3_34" vals="2136" realvals="2136" x="480.25045440831775" y="185.51857982433765" width="97.64033471063192" height="15.917585570053262"></rect><rect class="child" code="c3_25" desc="Malaysia" id="c3_25" vals="2341" realvals="2341" x="430.216693718748" y="236.38859445286442" width="50.033760689569704" height="34.044226485243314"></rect><rect class="child" code="c3_35" desc="Other Asia" id="c3_35" vals="3498" realvals="3498" x="430.216693718748" y="185.51857982433765" width="50.033760689569704" height="50.870014628526775"></rect><rect class="child" code="c3_8" desc="Brazil" id="c3_8" vals="3826" realvals="3826" x="552.2926700241122" y="161.8677348384275" width="117.70732997588777" height="23.65084498591014"></rect><rect class="child" code="c3_16" desc="Central America &amp; Carrib. exc. Mexico" id="c3_16" vals="3968" realvals="3968" x="430.216693718748" y="161.8677348384275" width="122.07597630536412" height="23.65084498591014"></rect><rect class="child" code="c3_41" desc="South Africa" id="c3_41" vals="4127" realvals="4127" x="370.60094870458425" y="220.06203843857088" width="59.615745014163736" height="50.37078249953686"></rect><rect class="child" code="c3_5" desc="Turkey" id="c3_5" vals="4768" realvals="4768" x="370.60094870458425" y="161.8677348384275" width="59.615745014163736" height="58.1943036001434"></rect><rect class="child" code="c3_4" desc="Russia" id="c3_4" vals="5617" realvals="5617" x="528.3572415458309" y="133.01312194306792" width="141.6427584541691" height="28.854612895359566"></rect><rect class="child" code="c3_28" desc="Saudi Arabia" id="c3_28" vals="6256" realvals="6256" x="370.60094870458425" y="133.01312194306792" width="157.75629284124665" height="28.854612895359566"></rect><rect class="child" code="c3_30" desc="South Korea" id="c3_30" vals="6309" realvals="6309" x="302.1963798888539" y="203.32384338878455" width="68.40456881573044" height="67.10897754932319"></rect><rect class="child" code="c3_20" desc="India" id="c3_20" vals="6610" realvals="6610" x="302.1963798888539" y="133.01312194306792" width="68.40456881573044" height="70.31072144571664"></rect><rect class="child" code="c3_29" desc="Singapore" id="c3_29" vals="7053" realvals="7053" x="488.63113104636" y="104.71768898893264" width="181.36886895364" height="28.29543295413528"></rect><rect class="child" code="c3_9" desc="Canada" id="c3_9" vals="7250" realvals="7250" x="302.1963798888539" y="104.71768898893264" width="186.43475115750607" height="28.29543295413528"></rect><rect class="child" code="c3_19" desc="Hong Kong" id="c3_19" vals="8242" realvals="8242" x="228.44421725909612" y="189.119246042287" width="73.7521626297578" height="81.31357489582075"></rect><rect class="child" code="c3_36" desc="Australia" id="c3_36" vals="8555" realvals="8555" x="228.44421725909612" y="104.71768898893264" width="73.7521626297578" height="84.40155705335435"></rect><rect class="child" code="c3_43" desc="Sub-Saharan Africa exc. South Africa" id="c3_43" vals="8824" realvals="8824" x="143.56139247142704" y="194.79293244651237" width="84.88282478766908" height="75.63988849159537"></rect><rect class="child" code="c3_24" desc="Japan" id="c3_24" vals="10508" realvals="10508" x="143.56139247142704" y="104.71768898893264" width="84.88282478766908" height="90.07524345757976"></rect><rect class="child" code="c3_33" desc="Other Gulf Arabian Countries" id="c3_33" vals="15968" realvals="15968" x="0" y="189.5012321515764" width="143.56139247142704" height="80.93158878653134"></rect><rect class="child" code="c3_18" desc="China" id="c3_18" vals="16728" realvals="16728" x="0" y="104.71768898893264" width="143.56139247142704" height="84.78354316264377"></rect><rect class="child" code="c3_13" desc="United States of America" id="c3_13" vals="96425" realvals="96425" x="0" y="0" width="670" height="104.71768898893264"></rect><rect class="parent" desc="Rest of World" id="c3" vals="249017" realvals="259955" x="0" y="0" width="670" height="270.43282093810774"></rect><text class="parentLabels" dy="1em" y="6" x="6" style="font-size: 37.0591px;"><tspan dy="1em">Rest  of  World  £259,955m </tspan></text></g></g><g class="grandparent"><rect id="gparent" y="0" width="670" height="0"></rect></g></g></svg></div>
</div>
<div id="source">
Source: <a href="https://www.ons.gov.uk/economy/nationalaccounts/balanceofpayments/adhocs/006656balanceofpaymentsannualgeographicaldatatables" target="_blank">Balance of Payments annual geographical data tables, 2015</a>, ONS
</div>
</div>
<div id="ieMsg" style="display:none">
<div id="suptext">
<h1>Browser requirements</h1>
<p><b>For a safer, faster, better experience online you should upgrade your browser. You would have been able to play with this lovely interactive graphic below. <a href="https://www.gov.uk/support/browsers" target="_blank">Find out more about browsers</a></b>
</p>
</div>
<img id="thumbNail" src="./exports.png">
</div>
</div>
</div>
<script type="text/javascript" async="" src="./ga.js"></script><script src="./jquery.min.js"></script>
<script src="./modernizr.custom.56904(1).js"></script>
<script src="./bootstrap.min.js" charset="utf-8"></script>
<script src="./pym(1).js" charset="utf-8"></script>
<script src="./d3.min.js" charset="utf-8"></script>
<script>
	
	if (Modernizr.inlinesvg= true ){		
		
			$("#main-wrapper").fadeIn(1000);
			$("#mainContent").fadeIn(1000);
			
		}else{
				$("#ieMsg").fadeIn(1000);
		}	
	
	
	
		
	pymChild = new pym.Child();	
					
			
    
	
	var	transitioning;	
	var widthCalc;  
	var heightCalc;	
	
	
	getSizes();

		
	$(window).resize(function () {
		  if(window.innerWidth != bwidth) {		 	
			getSizes();
		  }
	});		
	
	
	function getSizes() {
	
		bodywidth = d3.select("body").style("width");
		bwidth = bodywidth.replace('px', '');
		divwidth = d3.select("#chart").style("width");
		width = divwidth.replace('px', '') - 30;
		if(bwidth >= 767) {
			fullheight = 500;
			ratiovar = 0.5;
		} else {
			var url = (window.location != window.parent.location) ;
			if(url == false){
					ratiovar = 0.2;			
					windowheight = window.innerHeight;
					
					if(windowheight<=500) {
						fullheight = window.innerHeight;
					} else if (windowheight >500 && windowheight <=800) {
						fullheight = window.innerHeight - 250;
					} else if (windowheight >800 && windowheight <=2000) {
						fullheight = window.innerHeight - 350;
					}
			} else {
				ratiovar = 0.2;			
					windowheight = 500;
					fullheight =550;
			}
		}
		
		d3.select("#svgEle").remove();
		makeChart(width, fullheight);
	
	}
	
	
	
	
	
	function makeChart(width, fullheight) {
    		
	 margin = {top: 0, right: 0, bottom: 0, left: 0}
        formatNumber = d3.format(",.0f"),
		 
			
		atTop=true,
		level = 0,
		levelArray = Array(level);
   
    height = fullheight - margin.top - margin.bottom;
			
     x = d3.scale.linear()
        .domain([0, width])
        .range([0, width]);
    
     y = d3.scale.linear()
        .domain([0, height])
        .range([0, height]);
    
    treemap = d3.layout.treemap()
        .children(function(d, depth) { return depth ? null : d._children; })
        .sort(function(a, b) { return a.vals[0] - b.vals[0]; })
        .ratio(height / width * ratiovar * (1 + Math.sqrt(5)))
		.value(function(d) { return d.vals[0]; })
        .round(false);
    
     svg = d3.select("#chart")
		.append("svg")
		.attr("id", "svgEle")
		.attr("width", width + "px")
		.attr("height", height + "px")
		//.attr("viewBox", "0 0 "+width+" "+ (height))
		.attr("preserveAspectRatio", "xMidYMid meet")
        .style("margin-left", -margin.left + "px")
        .style("margin.right", -margin.right + "px")
      .append("g")
	  	.attr("id", "tree")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
       // .style("shape-rendering", "crispEdges");
    
     grandparent = svg.append("g")
        .attr("class", "grandparent")
	 	.append("rect")
	 	.attr("id", "gparent")
		.attr("y", -margin.top)
		.attr("width", width)
		.attr("height", margin.top);
      
   
    d3.json("tree_exp.json", function(root) {
		dataset = root;
		 initialize(root);
		 accumulate(root);
		 layout(root);
		 display(root);
		
	d3.select("#blurb").select("#txt3").html("Total exports: £"+formatNumber(dataset.vals[1])+" million");
			
		
	});
	
	 
	
	}
	
   	
      function initialize(root) {
        root.x = root.y = 0;
        root.dx = width;
	    root.dy = height;
        root.depth = 0;
      }
    
      // Aggregate the values for internal nodes. This is normally done by the
      // treemap layout, but not here because of our custom implementation.
      // We also take a snapshot of the original children (_children) to avoid
      // the children being overwritten when when layout is computed.
      function accumulate(d) {
		   //console.log('accumulate')
        return (d._children = d.children)
            ? d.vals[0] = d.children.reduce(function(p, v) { return p + accumulate(v); }, 0)
            : d.vals[0];
			
      }
    
      // Compute the treemap layout recursively such that each group of siblings
      // uses the same size (1×1) rather than the dimensions of the parent cell.
      // This optimizes the layout for the current zoom state. Note that a wrapper
      // object is created for the parent node for each group of siblings so that
      // the parent’s dimensions are not discarded as we recurse. Since each group
      // of sibling was laid out in 1×1, we must rescale to fit using absolute
      // coordinates. This lets us use a viewport to zoom.
      function layout(d) {
		   
        if (d._children) {
		
         treemap.nodes({_children: d._children});
          d._children.forEach(function(c) {
            c.x = d.x + c.x * d.dx;
            c.y = d.y + c.y * d.dy;
            c.dx *= d.dx;
            c.dy *= d.dy;
            c.parent = d;
			
            layout(c);
          });
        }
      }
    
      function display(d) {
		  
        grandparent
            .datum(d.parent)
            .on("click", transition)
//            .select("text")
//            .text(desc(d))
			
		d3.select("#titleText")
            .datum(d.parent)
           // .text(desc(d))
			
        var g1 = svg.insert("g", ".grandparent")
            .datum(d)
            .attr("class", "depth");
    
        var g = g1.selectAll("g")
            .data(d._children)
          .enter().append("g");
		  
        g.filter(function(d) { return d._children; })
            .classed("children", true)
            .on("click", transition);
    
        g.selectAll(".child")
            .data(function(d) { return d._children || [d]; })
          .enter().append("rect")
            .attr("class", "child")
			.attr("code",function(d) { return d.code} )
			.attr("desc",function(d) { return d.desc} )
			.attr("id",function(d) { return d.code} )
			.attr("vals",function(d) { return d.vals[0]} )
			.attr("realvals",function(d) { return d.vals[1]} )
			.on("mouseover", mouseover)
			.on("mouseout", mouseout)
            .call(rect);
		
        g.append("rect")
            .attr("class", "parent")
			.attr("desc",function(d) { return d.desc} )
			.attr("id",function(d) { return d.code} )
			.attr("vals",function(d) { return d.vals[0]} )
			.attr("realvals",function(d) { return d.vals[1]} )
			.on("mouseover", mouseover)
			.on("mouseout", mouseout)
            .call(rect);
			
       g.append("text")
			.attr("class", "parentLabels")
            .attr("dy", "1em")
            .text(function(d) { return d.desc+" £"+formatNumber(d.vals[1])+"m"; })
			.call(resize)
            .call(text);
		
		  
		  	
        function transition(d) {
			if(d3.select(this).attr("id") != "gparent"){
				selectedArray.push(d3.select(this).select('.parent').attr("id"))
				selectedView = selectedArray.join().replace(/,/g , "/")
								
				window.location.hash = encodeURI(selectedView);
			} else {
						selectedArray.splice(-1,1)					
						selectedView = selectedArray.join().replace(/,/g , "/")
						
						window.location.hash = encodeURI(selectedView)
			}
		
			
			
          if (transitioning || !d) return;
          transitioning = true;
  
          var g2 = display(d),
              t1 = g1.transition().duration(400),
              t2 = g2.transition().duration(400);
     
          // Update the domain only after entering new elements.
          x.domain([d.x, d.x + d.dx]);
          y.domain([d.y, d.y + d.dy]);
    
          // Enable anti-aliasing during the transition.
          svg.style("shape-rendering", null);
    
          // Draw child nodes on top of parent nodes.
          svg.selectAll(".depth").sort(function(a, b) { return a.depth - b.depth; });
   
          // Fade-in entering text.
          g2.selectAll("text").style("fill-opacity", 0);
    	
	
          // Transition to the new view.
          t1.selectAll("rect").call(rect);
		  t1.selectAll("text").call(text).style("fill-opacity", 1);
         // t1.selectAll(".childLabels").call(text).style("fill-opacity",1);
          t1.selectAll(".parentLabels").call(text).style("fill-opacity",1);
          
          t2.selectAll("rect").call(rect);
		  t2.selectAll("text").call(resize).call(text).style("fill-opacity", 1);
		//  t2.selectAll(".childLabels").call(text).call(resize2).style("fill-opacity", 1);
		  t2.selectAll(".parentLabels").call(resize).call(text).style("fill-opacity", 1);
         
    
          // Remove the old node when the transition is finished.
          t1.remove().each("end", function() {
            svg.style("shape-rendering", "crispEdges");
            transitioning = false;
          });
        
			myClass = $(this).attr("class");
			
			if(myClass=="children"){
				level = level+1;
				levelArray = Array(level);
			} else {
				level = level-1;
				levelArray = Array(level);
			}
			
		}
    
        return g;
		g.each( function(d,i) {
			d3.selectAll(".children").selectAll("text")
				.data(d._children).enter().append("text")
				.attr("class", "childLabels")
				.attr("dy", "0.5em")
				.text(function(d){ return d.desc;});
			})
      }
	  
	  function resize(text, width){
		  
			text.each(function(d,i) {
				
				var text = d3.select(this).style("font-size", function(d) { 
						return Math.sqrt((d.widthCalc*d.heightCalc))/ Math.log(this.getComputedTextLength())*0.45 + "px";  
				})	
			});
	  };
	  
	  function text(text, width) {
		  	text.each(function(d,i) {
				var text = d3.select(this),
					words = text.text().split(/\s+/).reverse(),
					word,
					line = [],
					y = text.attr("y"),
					dy = parseFloat(text.attr("dy")),
					tspan = text.text(null).append("tspan")/*.attr("x", 0).attr("y", y)*/.attr("dy",  "1em");
				
				while (word = words.pop()) {
				  line.push(word+" ");
				  tspan.text(line.join(" "));
				  
				 if (tspan.node().getComputedTextLength() >  d.widthCalc-10) {
					line.pop();
					tspan.text(line.join(" "));
					line = [word+" "];
					
					tspan = text.append("tspan").attr("x", function(d) { return x(d.x) + 6; }).attr("dy",  dy + "em").text(word+" ");
					
				  }
				 }		
			  });
				
       d3.selectAll(".parentLabels").attr("y", function(d) { return y(d.y) + 6; })
      					   			.attr("x", function(d) { return x(d.x) + 6; });
	  }
    
	
	  function rect(rect) {
		rect.attr("x", function(d) { return x(d.x); })
            .attr("y", function(d) { return y(d.y); })
      		.attr("width", function(d) {
				   widthCalc = x(d.x + d.dx) - x(d.x);
				  
				  d["widthCalc"] = widthCalc;
				  return widthCalc;
        	})
            .attr("height", function(d) {
				 heightCalc =y(d.y + d.dy) - y(d.y);
				 d["heightCalc"] = heightCalc;
				  return heightCalc;				  
     		})
	  }
    
//      function desc(d) {
//		return d.parent
//            ? desc(d.parent) + " > " + d.desc
//            : d.desc;
//      }
  
	
	function mouseover (d){
			
			var	selectClass = $(this).attr('desc');
			var	selectValue = $(this).attr('realvals');		
			d3.select("#blurb").select("#txt3").html(selectClass+": £"+formatNumber(selectValue)+" million");
		
	};
	
	function mouseout (){
			d3.select("#blurb").select("#txt3").html("Total exports: £"+formatNumber(dataset.vals[1])+" million");
	};
    
	function simulateClick(elem /* Must be the element */) {
		var evt = document.createEvent("MouseEvents");
		evt.initMouseEvent(
			"click", /* type */
			true, /* canBubble */
			true, /* cancelable */
			window, /* view */
			0, /* detail */
			0, /* screenX */
			0, /* screenY */
			0, /* clientX */
			0, /* clientY */
			false, /* ctrlKey */
			false, /* altKey */
			false, /* shiftKey */
			false, /* metaKey */
			0, /* button */
			null); /* relatedTarget */
		elem.dispatchEvent(evt);	
	}
	
	d3.select("#upBtn").on('click', function() {
	    	simulateClick(grandparent[0][0]);
			
	});
	
	d3.select("#topBtn").on('click', function() {
	    	backToTop();
	});
	
	
	
	setTimeout( function(){ 
	 	if (pymChild) {
       		pymChild.sendHeight();
			
			
			
			var url = decodeURI(window.location.hash);
			
			
			selectedArray = []
			if (url == ""){
				selectedView = "c0"	
			} else {
				params = url.split("/");
				params[0] = params[0].replace("#", "")
				storyArray = params;
				selectedView = storyArray.join().replace(/,/g , "/")
				
				$(storyArray).each(function(i){
					
					setTimeout(function(){
						storyId = "#"+storyArray[i];
						simulateClick(d3.select(storyId)[0][0]);						
					}, 760*i); 
			});
			
			}
			
		}
	}, 700)
	

		

		



function backToTop (){
				
			$(levelArray).each(function(i){		
				setTimeout(function(){
					simulateClick(grandparent[0][0]);
				},760*i);
			});
};



	function updateHash() {
	   
	}
		
		
		
    </script>
<script>


		  var _gaq = _gaq || [];
		  _gaq.push(['_setAccount', 'UA-37894017-1']);
		  _gaq.push(['_trackPageview']);
		
		
		  (function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		  })();

</script>


</body></html>